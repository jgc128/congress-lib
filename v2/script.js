var lcc_dict = {
'A': 'General Works',
'AC': 'Collections. Series. Collected works',
'AE': 'Encyclopedias',
'AG': 'Dictionaries and other general reference works',
'AI': 'Indexes',
'AM': 'Museums. Collectors and collecting',
'AN': 'Newspapers',
'AP': 'Periodicals',
'AS': 'Academies and learned societies',
'AY': 'Yearbooks. Almanacs. Directories',
'AZ': 'History of scholarship and learning. The humanities',
'B': 'Philosophy, Psychology, Religion',
'BC': 'Logic',
'BD': 'Speculative philosophy',
'BF': 'Psychology',
'BH': 'Aesthetics',
'BJ': 'Ethics',
'BL': 'Religions. Mythology. Rationalism',
'BM': 'Judaism',
'BP': 'Islam. Bahaism. Theosophy, etc.',
'BQ': 'Buddhism',
'BR': 'Christianity',
'BS': 'The Bible',
'BT': 'Doctrinal Theology',
'BV': 'Practical Theology',
'BX': 'Christian Denominations',
'C': 'Auxiliary Sciences of History (General)',
'CB': 'History of Civilization',
'CC': 'Archaeology',
'CD': 'Diplomatics. Archives. Seals',
'CE': 'Technical Chronology. Calendar',
'CJ': 'Numismatics',
'CN': 'Inscriptions. Epigraphy',
'CR': 'Heraldry',
'CS': 'Genealogy',
'CT': 'Biography',
'D': 'World History',
'DA': 'Great Britain',
'DAW': 'Central Europe',
'DB': 'Austria – Liechtenstein – Hungary – Czechoslovakia',
'DC': 'France – Andorra – Monaco',
'DD': 'Germany',
'DE': 'Greco-Roman World',
'DF': 'Greece',
'DG': 'Italy – Malta',
'DH': 'Low Countries – Benelux Countries',
'DJ': 'Netherlands (Holland)',
'DJK': 'Eastern Europe (General)',
'DK': 'Russia. Soviet Union. Former Soviet Republics – Poland',
'DL': 'Northern Europe. Scandinavia',
'DP': 'Spain – Portugal',
'DQ': 'Switzerland',
'DR': 'Balkan Peninsula',
'DS': 'Asia',
'DT': 'Africa',
'DU': 'Oceania (South Seas)',
'DX': 'Gypsies',
'E': 'American History',
'F': 'Local History',
'G': 'Geography, Anthropology, Recreation',
'GA': 'Mathematical geography. Cartography',
'GB': 'Physical geography',
'GC': 'Oceanography',
'GE': 'Environmental Sciences',
'GF': 'Human ecology. Anthropogeography',
'GN': 'Anthropology',
'GR': 'Folklore',
'GT': 'Manners and customs (General)',
'GV': 'Recreation. Leisure',
'H': 'Social Sciences',
'HA': 'Statistics',
'HB': 'Economic theory. Demography',
'HC': 'Economic history and conditions',
'HD': 'Industries. Land use. Labor',
'HE': 'Transportation and communications',
'HF': 'Commerce',
'HG': 'Finance',
'HJ': 'Public finance',
'HM': 'Sociology (General)',
'HN': 'Social history and conditions. Social problems. Social reform',
'HQ': 'The family. Marriage, Women and Sexuality',
'HS': 'Societies: secret, benevolent, etc.',
'HT': 'Communities. Classes. Races',
'HV': 'Social pathology. Social and public welfare. Criminology',
'HX': 'Socialism. Communism. Anarchism',
'J': 'Political Science',
'JA': 'Political science (General)',
'JC': 'Political theory',
'JF': 'Political institutions and public administration',
'JJ': 'Political institutions and public administration (North America)',
'JK': 'Political institutions and public administration (United States)',
'JL': 'Political institutions and public administration (Canada, Latin America, etc.)',
'JN': 'Political institutions and public administration (Europe)',
'JQ': 'Political institutions and public administration (Asia, Africa, Australia, Pacific Area, etc.)',
'JS': 'Local government. Municipal government',
'JV': 'Colonies and colonization. Emigration and immigration. International migration',
'JX': 'International law, see JZ and KZ (obsolete)',
'JZ': 'International relations',
'K': 'Law',
'KB': 'Religious law in general. Comparative religious law. Jurisprudence',
'KBM': 'Jewish law',
'KBP': 'Islamic law',
'KBR': 'History of canon law',
'KBS': 'Canon law of Eastern churches',
'KBT': 'Canon law of Eastern Rite Churches in Communion with the Holy See of Rome',
'KBU': 'Law of the Roman Catholic Church. The Holy See',
'KD': 'United Kingdom and Ireland',
'KDZ': 'America. North America',
'KE': 'Canada',
'KF': 'United States',
'KG': 'Latin America – Mexico and Central America – West Indies. Caribbean area',
'KH': 'South America',
'KJ': 'Europe',
'KL': 'Asia and Eurasia, Africa, Pacific Area, and Antarctica',
'KU': 'Law of Australia and New Zealand',
'KZ': 'Law of nations',
'L': 'Education',
'LA': 'History of education',
'LB': 'Theory and practice of education',
'LC': 'Special aspects of education',
'LD': 'Individual institutions – United States',
'LE': 'Individual institutions – America (except United States)',
'LF': 'Individual institutions – Europe',
'LG': 'Individual institutions – Asia, Africa, Indian Ocean islands, Australia, New Zealand, Pacific islands',
'LH': 'College and school magazines and papers',
'LJ': 'Student fraternities and societies, United States',
'LT': 'Textbooks',
'M': 'Music',
'ML': 'Literature on music',
'MT': 'Instruction and study',
'N': 'Fine Arts',
'NA': 'Architecture',
'NB': 'Sculpture',
'NC': 'Drawing. Design. Illustration',
'ND': 'Painting',
'NE': 'Print media',
'NK': 'Decorative arts',
'NX': 'Arts in general',
'P': 'Language and Literature',
'PA': 'Greek language and literature. Latin language and literature',
'PB': 'Modern languages. Celtic languages',
'PC': 'Romanic languages',
'PD': 'Germanic languages. Scandinavian languages',
'PE': 'English language',
'PF': 'West Germanic languages',
'PG': 'Slavic languages and literatures. Baltic languages. Albanian language',
'PH': 'Uralic languages. Basque language',
'PJ': 'Oriental languages and literatures',
'PK': 'Indo-Iranian languages and literatures',
'PL': 'Languages and literatures of Eastern Asia, Africa, Oceania',
'PM': 'Hyperborean, Native American, and artificial languages',
'PN': 'Literature (General)',
'PQ': 'French literature – Italian literature – Spanish literature – Portuguese literature',
'PR': 'English literature',
'PS': 'American literature',
'PT': 'German literature – Dutch literature – Flemish literature since 1830 – Afrikaans literature -Scandinavian literature – Old Norse literature: Old Icelandic and Old Norwegian – Modern Icelandic literature – Faroese literature – Danish literature – Norwegian literature – Swedish literature',
'PZ': 'Fiction and juvenile belles lettres',
'Q': 'Science',
'QA': 'Mathematics',
'QB': 'Astronomy',
'QC': 'Physics',
'QD': 'Chemistry',
'QE': 'Geology',
'QH': 'Natural history – Biology',
'QK': 'Botany',
'QL': 'Zoology',
'QM': 'Human anatomy',
'QP': 'Physiology',
'QR': 'Microbiology',
'R': 'Medicine',
'RA': 'Public aspects of medicine',
'RB': 'Pathology',
'RC': 'Internal medicine',
'RD': 'Surgery',
'RE': 'Ophthalmology',
'RF': 'Otorhinolaryngology',
'RG': 'Gynecology and Obstetrics',
'RJ': 'Pediatrics',
'RK': 'Dentistry',
'RL': 'Dermatology',
'RM': 'Therapeutics. Pharmacology',
'RS': 'Pharmacy and materia medica',
'RT': 'Nursing',
'RV': 'Botanic, Thomsonian, and Eclectic medicine',
'RX': 'Homeopathy',
'RZ': 'Other systems of medicine',
'S': 'Agriculture',
'SB': 'Horticulture. Plant propagation. Plant breeding',
'SD': 'Forestry. Arboriculture. Silviculture',
'SF': 'Animal husbandry. Animal science',
'SH': 'Aquaculture. Fisheries. Angling',
'SK': 'Hunting',
'T': 'Technology',
'TA': 'Engineering Civil engineering (General).',
'TC': 'Hydraulic engineering. Ocean engineering',
'TD': 'Environmental technology. Sanitary engineering',
'TE': 'Highway engineering. Roads and pavements',
'TF': 'Railroad engineering and operation',
'TG': 'Bridges',
'TH': 'Building construction',
'TJ': 'Mechanical engineering and machinery',
'TK': 'Electrical engineering. Electronics. Nuclear engineering',
'TL': 'Motor vehicles. Aeronautics. Astronautics',
'TN': 'Mining engineering. Metallurgy',
'TP': 'Chemical technology',
'TR': 'Photography',
'TS': 'Manufacturing engineering. Mass production',
'TT': 'Handicrafts. Arts and crafts',
'TX': 'Home economics',
'U': 'Military Science',
'UA': 'Armies: Organization, distribution, military situation',
'UB': 'Military administration',
'UC': 'Military maintenance and transportation',
'UD': 'Infantry',
'UE': 'Cavalry. Armor',
'UF': 'Artillery',
'UG': 'Military engineering. Air forces',
'UH': 'Other military services',
'V': 'Naval Science',
'VA': 'Navies: Organization, distribution, naval situation',
'VB': 'Naval administration',
'VC': 'Naval maintenance',
'VD': 'Naval seamen',
'VE': 'Marines',
'VF': 'Naval ordnance',
'VG': 'Minor services of navies',
'VK': 'Navigation. Merchant marine',
'VM': 'Naval architecture. Shipbuilding. Marine engineering',
'Z': 'Bibliography, Library Science',
'ZA': 'Information resources (General)',
};


Number.prototype.map = function ( in_min , in_max , out_min , out_max ) {
  return ( this - in_min ) * ( out_max - out_min ) / ( in_max - in_min ) + out_min;
}

d3.json("lcc-lcsh-1950.json", function(error, graph) {
	var width, height;

	var color = d3.scale.category20();
	var force = d3.layout.force();
	var svg = d3.select("body").append("svg");

	var options = {
		'charge': parseInt(d3.select("#charge").property("value")),
		'strength': parseFloat(d3.select("#strength").property("value")),
	};

	force
		.nodes(graph.nodes)
		.links(graph.links)

		.charge(options.charge)
		.linkStrength(options.strength)
		//.linkStrength(function(d) { return d.count.map(0, 40, 0, 1); })
		.linkDistance(function(d) { return d.type == 'first' ? 100 - d.count : 50; })
		.start()
	;

	var link = svg.selectAll(".link")
		.data(graph.links)
		.enter().append("line")
		.attr("class", "link")
		.style("stroke-width", function(d) { return d.count != 0 ? Math.sqrt(d.count) : 1.5; })
	;

	var node = svg.selectAll("g")
		.data(graph.nodes)
		.enter().append('g')
		.call(force.drag)
	;
		
	var nodeCircle = node.append("circle")
		.attr("class", "node")
		.attr("r", function(d) { return Math.sqrt(d.count); })
		.style("fill", function(d) { return color(d.code[0]); })
	;
	var nodeText = node
		.filter(function(d){ return d.type == "first"; })
		.append("text")
		.attr("class", "title")
		.attr("text-anchor", "middle")
		.attr("dy", function(d){ return 15 + Math.sqrt(d.count); })
		.text(function(d) { return lcc_dict[d.code]; })
	;
	
	nodeCircle.append("title")
		.text(function(d) { return d.code + ': ' + lcc_dict[d.code]; })
	;
	
	resize();
	updateCharge(options.charge);
	updateStrength(options.strength);
	
	d3.select(window).on("resize", resize);	
	d3.select('#charge').on("change", function(){ updateCharge(parseInt(this.value)) });
	d3.select('#strength').on("change", function(){ updateStrength(parseFloat(this.value)) });
	
	node.on('mouseover', function(d) {
	  link.attr('class', function(l) {
		if (d === l.source || d === l.target)
		  return 'link-selected';
		else
		  return 'link';
		});
	});

	// Set the stroke width back to normal when mouse leaves the node.
	node.on('mouseout', function() {
	  link.attr('class', 'link');
	});	
		
	force.on("tick", function() {
		
		link
			.attr("x1", function(d) { return d.source.x; })
			.attr("y1", function(d) { return d.source.y; })
			.attr("x2", function(d) { return d.target.x; })
			.attr("y2", function(d) { return d.target.y; })
		;
		node
			.attr("transform", function(d){return "translate("+d.x+","+d.y+")"})
		;
	});

	function resize() {
		width = window.innerWidth;
		height = window.innerHeight;
		
		svg.attr("width", width).attr("height", height);
		force.size([width, height]).resume();
	}	
	function updateCharge(value)
	{
		options.charge = value;
		d3.select('#charge-label').text('Charge: ' + options.charge);
		force.charge(options.charge).start()
	}
	function updateStrength(value)
	{
		options.strength = value;
		d3.select('#strength-label').text('Strength: ' + options.strength);
		force.linkStrength(options.strength).start()
	}	
});
